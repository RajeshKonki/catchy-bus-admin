<!-- Page Header -->
<div class="page-header">
    <h1>{{ isEditMode ? 'Edit College' : 'Add New College' }}</h1>
    <a routerLink="/colleges" class="btn btn-ghost">
        <i class="fas fa-arrow-left"></i> Back to List
    </a>
</div>

<div *ngIf="loading" class="loading-state">
    <i class="fas fa-spinner fa-spin"></i> Loading...
</div>

<!-- Form Container -->
<div class="form-container" *ngIf="!loading">
    <div class="form-container-header">
        <i class="fas fa-university"></i>
        <h2>{{ isEditMode ? 'Update College Details' : 'Register New College' }}</h2>
    </div>

    <div class="form-body">
        <div *ngIf="error" class="error-alert">
            <i class="fas fa-exclamation-circle"></i> {{ error }}
        </div>

        <form [formGroup]="collegeForm" (ngSubmit)="onSubmit()">
            <!-- Basic Info -->
            <div class="form-section-title">
                <i class="fas fa-info-circle"></i> College Information
            </div>

            <div class="form-row">
                <div class="form-group col-md-8">
                    <label for="name">College Name *</label>
                    <input id="name" type="text" formControlName="name" class="form-control"
                        placeholder="e.g. Bangalore Institute of Technology">
                    <div class="validation-error"
                        *ngIf="collegeForm.get('name')?.touched && collegeForm.get('name')?.invalid">
                        Name is required
                    </div>
                </div>

                <div class="form-group col-md-4">
                    <label>College Logo/Photo</label>
                    <div class="image-upload-container">
                        <input type="file" id="college-image" accept="image/*" (change)="onFileSelected($event)"
                            *ngIf="!previewUrl">

                        <div class="upload-placeholder" *ngIf="!previewUrl">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload logo</p>
                        </div>

                        <div class="image-preview" *ngIf="previewUrl">
                            <img [src]="previewUrl" alt="College preview">
                            <button type="button" class="remove-image-btn" (click)="removeImage()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="address">Address *</label>
                <div class="address-with-map">
                    <textarea id="address" formControlName="address" class="form-control" rows="2"
                        placeholder="e.g. K.R. Road, V.V. Puram, Bangalore"></textarea>
                    <button type="button" class="btn-pick-map" (click)="openMapPicker()">
                        <i class="fas fa-map-marker-alt"></i> Pick on Map
                    </button>
                </div>
                <div class="validation-error"
                    *ngIf="collegeForm.get('address')?.touched && collegeForm.get('address')?.invalid">
                    Address is required
                </div>

                <!-- Coordinates display -->
                <div class="coords-display" *ngIf="selectedLat !== null && selectedLng !== null">
                    <div class="coord-badge">
                        <i class="fas fa-crosshairs"></i>
                        <span class="coord-label">Latitude</span>
                        <span class="coord-value">{{ selectedLat?.toFixed(6) }}</span>
                    </div>
                    <div class="coord-badge">
                        <i class="fas fa-crosshairs"></i>
                        <span class="coord-label">Longitude</span>
                        <span class="coord-value">{{ selectedLng?.toFixed(6) }}</span>
                    </div>
                    <button type="button" class="btn-clear-coords" (click)="clearLocation()" title="Clear location">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="coords-hint" *ngIf="selectedLat === null">
                    <i class="fas fa-info-circle"></i> Use "Pick on Map" to set precise coordinates
                </div>
            </div>

            <!-- Contact Detils -->
            <div class="form-section-title">
                <i class="fas fa-address-card"></i> Contact Details
            </div>

            <div class="form-group">
                <label for="contactPerson">Contact Person *</label>
                <input id="contactPerson" type="text" formControlName="contactPerson" class="form-control"
                    placeholder="e.g. Dr. Suresh Kumar">
                <div class="validation-error"
                    *ngIf="collegeForm.get('contactPerson')?.touched && collegeForm.get('contactPerson')?.invalid">
                    Contact person is required
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input id="email" type="email" formControlName="email" class="form-control"
                        placeholder="e.g. support@bit.edu.in">
                    <div class="validation-error"
                        *ngIf="collegeForm.get('email')?.touched && collegeForm.get('email')?.invalid">
                        Valid email is required
                    </div>
                </div>
                <div class="form-group">
                    <label for="phone">Phone *</label>
                    <input id="phone" type="tel" formControlName="phone" class="form-control"
                        placeholder="e.g. 9876543210">
                    <div class="validation-error"
                        *ngIf="collegeForm.get('phone')?.touched && collegeForm.get('phone')?.invalid">
                        Phone is required
                    </div>
                </div>
            </div>

            <!-- Login Credentials -->
            <div class="form-section-title">
                <i class="fas fa-lock"></i> Login Credentials
            </div>

            <div class="credentials-info" *ngIf="isEditMode">
                <i class="fas fa-info-circle"></i>
                Leave password blank to keep the existing password unchanged.
            </div>

            <div class="form-row">
                <div class="form-group col">
                    <label for="loginEmail">Login Email *</label>
                    <input id="loginEmail" type="email" formControlName="loginEmail" class="form-control"
                        placeholder="e.g. college@bit.edu.in">
                    <div class="validation-error"
                        *ngIf="collegeForm.get('loginEmail')?.touched && collegeForm.get('loginEmail')?.invalid">
                        Valid login email is required
                    </div>
                </div>
                <div class="form-group col">
                    <label for="loginPassword">
                        Login Password {{ isEditMode ? '(optional)' : '*' }}
                    </label>
                    <div class="password-field">
                        <input id="loginPassword" [type]="showPassword ? 'text' : 'password'"
                            formControlName="loginPassword" class="form-control"
                            [placeholder]="isEditMode ? 'Leave blank to keep current' : 'Enter password'">
                        <button type="button" class="btn-toggle-password" (click)="showPassword = !showPassword"
                            [title]="showPassword ? 'Hide password' : 'Show password'">
                            <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                        </button>
                    </div>
                    <div class="validation-error"
                        *ngIf="collegeForm.get('loginPassword')?.touched && collegeForm.get('loginPassword')?.invalid">
                        Password is required
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="status">Status *</label>
                <select id="status" formControlName="status" class="form-control">
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                </select>
            </div>
        </form>
    </div>

    <div class="form-actions">
        <a routerLink="/colleges" class="btn btn-ghost">Cancel</a>
        <button type="submit" class="btn btn-primary" [disabled]="collegeForm.invalid || submitting"
            (click)="onSubmit()">
            <i class="fas fa-spinner fa-spin" *ngIf="submitting"></i>
            <i class="fas fa-save" *ngIf="!submitting"></i>
            {{ submitting ? 'Saving...' : (isEditMode ? 'Update College' : 'Create College') }}
        </button>
    </div>
</div>

<!-- Map Picker Modal -->
<app-map-picker *ngIf="showMapPicker" [initialLat]="selectedLat ?? 17.0018" [initialLng]="selectedLng ?? 81.7877"
    (locationSelected)="onLocationSelected($event)" (closed)="onMapPickerClosed()">
</app-map-picker>