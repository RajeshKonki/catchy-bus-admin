<!-- Page Header -->
<div class="page-header">
    <h1>Change Password</h1>
    <a routerLink="/settings" class="btn btn-ghost">
        <i class="fas fa-arrow-left"></i> Back to Settings
    </a>
</div>

<div class="settings-layout" style="max-width:560px;">
    <div class="settings-card">
        <div class="settings-card-header">
            <i class="fas fa-key"></i>
            <h3>Update Password</h3>
        </div>

        <div *ngIf="error" class="error-alert">
            <i class="fas fa-exclamation-circle"></i> {{ error }}
        </div>
        <div *ngIf="success" class="success-alert">
            <i class="fas fa-check-circle"></i> {{ success }}
        </div>

        <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
                <label for="currentPassword">Current Password *</label>
                <div class="password-input">
                    <input id="currentPassword" [type]="showCurrent ? 'text' : 'password'"
                        formControlName="currentPassword" class="form-control" placeholder="Enter current password">
                    <button type="button" class="toggle-btn" (click)="showCurrent = !showCurrent">
                        <i class="fas" [class.fa-eye]="!showCurrent" [class.fa-eye-slash]="showCurrent"></i>
                    </button>
                </div>
                <div class="validation-error"
                    *ngIf="passwordForm.get('currentPassword')?.touched && passwordForm.get('currentPassword')?.invalid">
                    Current password is required
                </div>
            </div>

            <div class="form-group">
                <label for="newPassword">New Password *</label>
                <div class="password-input">
                    <input id="newPassword" [type]="showNew ? 'text' : 'password'" formControlName="newPassword"
                        class="form-control" placeholder="Minimum 8 characters">
                    <button type="button" class="toggle-btn" (click)="showNew = !showNew">
                        <i class="fas" [class.fa-eye]="!showNew" [class.fa-eye-slash]="showNew"></i>
                    </button>
                </div>
                <div class="validation-error"
                    *ngIf="passwordForm.get('newPassword')?.touched && passwordForm.get('newPassword')?.invalid">
                    Password must be at least 8 characters
                </div>
                <!-- Password Strength -->
                <div class="password-strength" *ngIf="passwordForm.get('newPassword')?.value">
                    <div class="strength-bar">
                        <div class="strength-fill" [ngClass]="passwordStrengthClass"
                            [style.width]="passwordStrengthWidth"></div>
                    </div>
                    <span class="strength-label" [ngClass]="passwordStrengthClass">{{ passwordStrengthLabel }}</span>
                </div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirm New Password *</label>
                <div class="password-input">
                    <input id="confirmPassword" [type]="showConfirm ? 'text' : 'password'"
                        formControlName="confirmPassword" class="form-control" placeholder="Re-enter new password">
                    <button type="button" class="toggle-btn" (click)="showConfirm = !showConfirm">
                        <i class="fas" [class.fa-eye]="!showConfirm" [class.fa-eye-slash]="showConfirm"></i>
                    </button>
                </div>
                <div class="validation-error"
                    *ngIf="passwordForm.get('confirmPassword')?.touched && passwordForm.errors?.['passwordMismatch']">
                    Passwords do not match
                </div>
            </div>

            <div class="form-actions" style="margin-top:1.5rem;">
                <a routerLink="/settings" class="btn btn-ghost">Cancel</a>
                <button type="submit" class="btn btn-primary" [disabled]="passwordForm.invalid || submitting">
                    <i class="fas fa-spinner fa-spin" *ngIf="submitting"></i>
                    <i class="fas fa-lock" *ngIf="!submitting"></i>
                    {{ submitting ? 'Updating...' : 'Update Password' }}
                </button>
            </div>
        </form>
    </div>
</div>